-- [[ 0. Xeno ìµœì í™” ë° ë¡œì»¬ ìºì‹± ê°•í™” ]]
local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local runService = game:GetService("RunService")
local userInput = game:GetService("UserInputService")
local camera = workspace.CurrentCamera

-- ë¹ˆë²ˆí•œ í˜¸ì¶œ í•¨ìˆ˜ ë¡œì»¬ ìºì‹± (CPU ë¶€í•˜ ê°ì†Œ)
local WorldToViewportPoint = camera.WorldToViewportPoint
local Vector2new = Vector2.new
local Vector3new = Vector3.new
local CFnew = CFrame.new
local mouse1press = mouse1press
local mouse1release = mouse1release
local mousemoverel = mousemoverel
local tick = tick

-- [[ ë£¨í”„ ì œì–´ ë³€ìˆ˜ ìµœìƒìœ„ ì„ ì–¸ ]]
local MainLoop = nil 
local SearchLoop = nil -- ìµœì í™”ë¥¼ ìœ„í•œ íƒìƒ‰ ì „ìš© ë£¨í”„ ì¶”ê°€

-- [[ 1. Xeno ì „ìš© Safe Drawing ì—”ì§„ ]]
local function CreateSafeDrawing(class, props)
    local obj = nil
    pcall(function() 
        obj = Drawing.new(class) 
    end)
    if not obj or type(obj) == "number" then
        return { Visible = false, Remove = function() end, Destroy = function() end }
    end
    for k, v in pairs(props) do pcall(function() obj[k] = v end) end
    return obj
end

-- [ê¸°ì¡´ ë“œë¡œì‰ ê°ì²´]
local fovCircle = CreateSafeDrawing("Circle", {Thickness = 1, NumSides = 100, Radius = 150, Visible = false, Color = Color3.fromRGB(140, 0, 255)})
local targetLine = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false, Color = Color3.fromRGB(255, 0, 0)})

-- [ì¶”ê°€ëœ ESP ê°ì²´: ë‹¨ì¼ íƒ€ê²Ÿìš© ì¬ì‚¬ìš© í’€ (Skeleton Box & HeadDot)]
local TargetESP_Box = {
    TL = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false}), 
    TR = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false}),
    BL = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false}), 
    BR = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false}),
    L = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false}), 
    R = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false}),
    T = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false}), 
    B = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false})
}
local TargetESP_HeadDot = CreateSafeDrawing("Circle", {Thickness = 1, Filled = false, Visible = false})

--------------------------------------------------
-- ğŸ¨ UI SYSTEM (ë¬´ê²°ì„± ë³´ì¡´ + ë“œë¡­ë‹¤ìš´ ë³€ê²½)
--------------------------------------------------
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/Library.lua"))()

Library.BackgroundColor = Color3.fromRGB(10, 5, 20)
Library.MainColor       = Color3.fromRGB(25, 8, 45)
Library.AccentColor     = Color3.fromRGB(190, 40, 255)
Library.SelectedTabColor= Color3.fromRGB(150, 30, 220)
Library.OutlineColor    = Color3.fromRGB(60, 20, 100)

local Window = Library:CreateWindow({
    Title = "Lax Hub V1 - Gemini Mod",
    Center = true,
    AutoShow = true,
    TabPadding = 8,
    MenuFadeTime = 0.2
})

local MainTab = Window:AddTab("Main")

-- [ğŸ¯ AIMBOT ì„¹ì…˜]
local AimBox = MainTab:AddLeftTabbox("Aimbot")
local AimTab = AimBox:AddTab("Aimbot") do
    AimTab:AddToggle("Enabled", { Text = "Aimbot ON / OFF", Default = false, Tooltip = "Toggle the main Aimbot system on or off." }):AddKeyPicker("AimKey", { Default = "T", SyncToggleState = true, Mode = "Toggle", Text = "Aimbot Key" })
    AimTab:AddDropdown("AimMethod", { Text = "Aimbot type", Default = "Camera", Values = { "Camera", "Mouse" }, Tooltip = "Choose between Camera manipulation or Mouse movement for aiming." })
    AimTab:AddToggle("TeamCheck", { Text = "Team Check", Default = true, Tooltip = "Prevents the script from targeting teammates." })
    AimTab:AddToggle("WallCheck", { Text = "Wall Check", Default = true, Tooltip = "Only targets enemies who are visible and not behind walls." })
    AimTab:AddToggle("FFCheck", { Text = "ForceField Check", Default = true, Tooltip = "Ignore players with active spawn protection (ForceField)." })
    AimTab:AddToggle("StrongLock", { Text = "Absolute Sticky Lock", Default = false, Tooltip = "Increases aim stickiness to prevent losing the target." })
    AimTab:AddSlider("Smoothing", { Text = "Aimbot Smoothness", Default = 2, Min = 1, Max = 10, Rounding = 1, Tooltip = "Controls how smoothly the aim follows the target. Higher = Smoother." })
    AimTab:AddSlider("AimMaxDistance", { Text = "Aimbot Scan Distance", Default = 1000, Min = 10, Max = 5000, Rounding = 0, Tooltip = "Maximum distance in studs to detect targets for Aimbot." })
    AimTab:AddToggle("ADSOnly", { Text = "Ads Check", Default = false, Tooltip = "Aimbot only activates while you are aiming down sights (Right Click)." })
    AimTab:AddToggle("PredictionEnabled", { Text = "Prediction (Lead Aim)", Default = false, Tooltip = "Calculates target movement to lead shots ahead of them." })
    AimTab:AddSlider("PredictionValue", { Text = "Prediction Intensity", Default = 5, Min = 1, Max = 10, Rounding = 1, Tooltip = "Adjust how far ahead the lead aim should predict." })
end

-- [ğŸ”« TRIGGERBOT ì„¹ì…˜]
local TriggerBox = MainTab:AddLeftTabbox("TriggerBot")
local TriggerTab = TriggerBox:AddTab("TriggerBot") do
    TriggerTab:AddToggle("GeneralTriggerBot", { Text = "TriggerBot ON / OFF", Default = false, Tooltip = "Automatically fires when an enemy is in range/FOV." }):AddKeyPicker("TriggerKey", { Default = "V", SyncToggleState = true, Mode = "Toggle", Text = "Trigger Key" })
    -- [ì£¼ì˜] Dropdown ê°’ì€ "360 check" ì…ë‹ˆë‹¤. ì½”ë“œì—ì„œ ì´ ë¬¸ìì—´ì„ ì •í™•íˆ ë¹„êµí•´ì•¼ í•©ë‹ˆë‹¤.
    TriggerTab:AddDropdown("TriggerType", { Text = "Trigger Type", Default = "FOV Check", Values = { "360 check", "FOV Check" }, Tooltip = "360: Fires at anyone in world range. FOV Check: Only fires inside the circle." })
    TriggerTab:AddSlider("ScanRange360", { Text = "360 Scan Range", Default = 500, Min = 100, Max = 2000, Rounding = 0, Tooltip = "The maximum distance in studs for 360-degree detection." })
    TriggerTab:AddSlider("FireRate", { Text = "Fire Delay", Default = 0.05, Min = 0.01, Max = 2, Rounding = 2, Tooltip = "The delay between each shot fired by TriggerBot." })
end

-- [âš™ SETTINGS ì„¹ì…˜]
local SettingsBox = MainTab:AddRightTabbox("Settings")
local SettingsTab = SettingsBox:AddTab("Settings") do
    SettingsTab:AddToggle("ShowFOV", { Text = "Show FOV", Default = true, Tooltip = "Renders a visual circle representing your aim field-of-view." })
    SettingsTab:AddSlider("FOVSize", { Text = "FOV Size", Default = 150, Min = 10, Max = 800, Rounding = 0, Tooltip = "The radius of the Aimbot's activation area." })
    
    -- [ìŠ¹ì¸ëœ ë³€ê²½: ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ êµì²´]
    SettingsTab:AddDropdown("VisualType", { 
        Text = "Target Visual Type", 
        Default = "Tracer", 
        Values = { "None", "Tracer", "corner Box/head dot" }, 
        Tooltip = "Choose how the detected target is visualized.\nTracer: Line to target.\nSkeleton Box: Corner Box & Head Dot." 
    })

    SettingsTab:AddLabel("FOV Color"):AddColorPicker("FOVColor", { Default = Color3.fromRGB(140, 0, 255) })
    SettingsTab:AddLabel("Visual Color"):AddColorPicker("TracerColor", { Default = Color3.fromRGB(255, 0, 0) }) -- Tracer & Box ê²¸ìš©
    
    SettingsTab:AddButton("CRUSH GUI", function() 
        if MainLoop then MainLoop:Disconnect(); MainLoop = nil end 
        if SearchLoop then SearchLoop:Disconnect(); SearchLoop = nil end
        mouse1release()
        pcall(function() fovCircle:Remove() end)
        pcall(function() targetLine:Remove() end)
        -- [ì¶”ê°€ëœ ê°ì²´ ì •ë¦¬]
        pcall(function() 
            for _, v in pairs(TargetESP_Box) do v:Remove() end 
            TargetESP_HeadDot:Remove()
        end)
        Library:Unload() 
    end)
end

--------------------------------------------------
-- ğŸš€ CORE LOGIC (ìµœì í™” ì—”ì§„ ì ìš©)
--------------------------------------------------
local lastFireTime = 0
local lockedTarget = nil
local currentBestTarget = nil -- íƒìƒ‰ ë£¨í”„ì™€ ì‹¤í–‰ ë£¨í”„ ë¸Œë¦¿ì§€
local isCurrentlyFiring = false

-- ìµœì í™”ëœ ê°€ì‹œì„± ì²´í¬ (ë ˆì´ìºìŠ¤íŠ¸ íšŸìˆ˜ ìµœì†Œí™”)
local function isVisible(part, wallCheckEnabled)
    if not wallCheckEnabled then return true end
    local char = localPlayer.Character
    if not char then return false end
    
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {char, camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    local result = workspace:Raycast(camera.CFrame.Position, (part.Position - camera.CFrame.Position), params)
    return result == nil or result.Instance:IsDescendantOf(part.Parent)
end

-- [[ ìµœì í™” a: íƒ€ê²Ÿ íƒìƒ‰ ì „ìš© ë£¨í”„ (í•‘ ë° ë ‰ ë°©ì§€) ]]
SearchLoop = runService.Heartbeat:Connect(function()
    local isTriggerOn = Toggles.GeneralTriggerBot.Value
    local isAimOn = Toggles.Enabled.Value
    if not (isTriggerOn or isAimOn) then currentBestTarget = nil return end

    local myChar = localPlayer.Character
    local myHead = myChar and myChar:FindFirstChild("Head")
    if not myHead then currentBestTarget = nil return end

    local mouseLoc = userInput:GetMouseLocation()
    local tempBestTarget = nil
    local shortestDist = 9e9
    
    -- ì „ì—­ ì„¤ì • ìºì‹±
    local fovRadius = Options.FOVSize.Value
    local maxAimDist = Options.AimMaxDistance.Value
    -- [ìˆ˜ì •ë¨: ë¬¸ìì—´ ë¶ˆì¼ì¹˜ ì˜¤ë¥˜ í•´ê²°. "360 check"ì™€ ì •í™•íˆ ë§¤ì¹­]
    local is360Mode = (isTriggerOn and Options.TriggerType.Value == "360 check")
    local scanRange360 = Options.ScanRange360.Value

    -- Sticky Lock ìš°ì„  ìˆœìœ„
    if Toggles.StrongLock.Value and lockedTarget then
        local lp = lockedTarget.Parent
        local lh = lp and lp:FindFirstChildOfClass("Humanoid")
        if lh and lh.Health > 0 then tempBestTarget = lockedTarget end
    end

    if not tempBestTarget then
        for _, player in ipairs(players:GetPlayers()) do
            if player == localPlayer then continue end
            if Toggles.TeamCheck.Value and player.Team == localPlayer.Team then continue end

            local char = player.Character
            local head = char and char:FindFirstChild("Head")
            local hum = char and char:FindFirstChildOfClass("Humanoid")

            if head and hum and hum.Health > 0 then
                if Toggles.FFCheck.Value and char:FindFirstChildOfClass("ForceField") then continue end

                local worldDist = (myHead.Position - head.Position).Magnitude
                
                -- ê°€ë²¼ìš´ ì¡°ê±´(ê±°ë¦¬/FOV)ì„ ë¨¼ì € ì²´í¬í•˜ì—¬ ë¬´ê±°ìš´ ë ˆì´ìºìŠ¤íŠ¸(í•‘ ìƒìŠ¹ ì›ì¸) íšŸìˆ˜ë¥¼ ì¤„ì„
                if is360Mode then
                    if worldDist <= scanRange360 and worldDist < shortestDist then
                        if isVisible(head, Toggles.WallCheck.Value) then
                            tempBestTarget = head; shortestDist = worldDist
                        end
                    end
                else
                    if worldDist <= maxAimDist then
                        local screenPos, onScreen = WorldToViewportPoint(camera, head.Position)
                        if onScreen then
                            local screenPos2D = Vector2new(screenPos.X, screenPos.Y)
                            local distFromMouse = (screenPos2D - mouseLoc).Magnitude
                            if distFromMouse <= fovRadius and distFromMouse < shortestDist then
                                if isVisible(head, Toggles.WallCheck.Value) then
                                    tempBestTarget = head; shortestDist = distFromMouse
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    currentBestTarget = tempBestTarget
end)

-- [[ ë©”ì¸ ì‹¤í–‰ ë£¨í”„ (RenderStepped: ì¡°ì¤€ ë°˜ì‘ì„± ìœ ì§€) ]]
MainLoop = runService.RenderStepped:Connect(function()
    local mouseLoc = userInput:GetMouseLocation()
    local isRightMouseDown = userInput:IsMouseButtonPressed(Enum.UserInputType.MouseButton2)
    local isTriggerKeyDown = Toggles.GeneralTriggerBot.Value
    local isAimKeyDown = Toggles.Enabled.Value and (not Toggles.ADSOnly.Value or isRightMouseDown)
    
    -- íƒ€ê²Ÿ ë™ê¸°í™”
    lockedTarget = (isAimKeyDown or isTriggerKeyDown) and currentBestTarget or nil

    -- [FOV ë Œë”ë§ ìµœì í™”]
    pcall(function()
        -- [ìˆ˜ì •ë¨: ë¬¸ìì—´ ë§¤ì¹­ ìˆ˜ì •]
        local is360Mode = (isTriggerKeyDown and Options.TriggerType.Value == "360 check")
        local shouldVisible = Toggles.ShowFOV.Value and not is360Mode
        fovCircle.Visible = shouldVisible
        if shouldVisible then
            fovCircle.Radius = Options.FOVSize.Value
            fovCircle.Position = mouseLoc
            fovCircle.Color = Options.FOVColor.Value
            fovCircle.Transparency = 1
        end
    end)

    -- [íƒ€ê²Ÿ ë¹„ì£¼ì–¼ ì‹œìŠ¤í…œ (í†µí•©)]
    -- ìš”ì²­í•˜ì‹  ëŒ€ë¡œ "ì ì´ ê°ì§€ë˜ë©´ ë¯¸ë¦¬ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥"ì„ ìœ„í•´ currentBestTargetì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    pcall(function()
        local visualType = Options.VisualType.Value
        local visualColor = Options.TracerColor.Value

        -- ëª¨ë“  ë¹„ì£¼ì–¼ ì´ˆê¸°í™” (ì”ìƒ ì œê±°)
        targetLine.Visible = false
        for _, line in pairs(TargetESP_Box) do line.Visible = false end
        TargetESP_HeadDot.Visible = false

        if currentBestTarget and visualType ~= "None" then
            local char = currentBestTarget.Parent
            local hrp = char and char:FindFirstChild("HumanoidRootPart")
            
            if char and hrp then
                local tPos, tOnScreen = WorldToViewportPoint(camera, currentBestTarget.Position)

                if tOnScreen then
                    if visualType == "Tracer" then
                        -- [ê¸°ì¡´ Tracer]
                        targetLine.Visible = true
                        targetLine.From = Vector2new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
                        targetLine.To = Vector2new(tPos.X, tPos.Y)
                        targetLine.Color = visualColor
                    
                    elseif visualType == "Skeleton Box" then
                        -- [ì¶”ê°€ëœ Skeleton Box ESP - Source 1 ë¡œì§ ì´ì‹]
                        local size = char:GetExtentsSize()
                        local topPos = WorldToViewportPoint(camera, (hrp.CFrame * CFnew(0, size.Y/2 + 0.5, 0)).Position)
                        local bottomPos = WorldToViewportPoint(camera, (hrp.CFrame * CFnew(0, -size.Y/2 - 0.5, 0)).Position)
                        
                        local screenSize = math.abs(bottomPos.Y - topPos.Y)
                        local boxWidth = screenSize * 0.65
                        local boxX = topPos.X - boxWidth/2
                        local cornerLen = boxWidth * 0.25

                        -- ë°•ìŠ¤ ë¼ì¸ ì¢Œí‘œ ê³„ì‚°
                        local b = TargetESP_Box
                        b.TL.From = Vector2new(boxX, topPos.Y); b.TL.To = Vector2new(boxX + cornerLen, topPos.Y)
                        b.TR.From = Vector2new(boxX + boxWidth, topPos.Y); b.TR.To = Vector2new(boxX + boxWidth - cornerLen, topPos.Y)
                        b.BL.From = Vector2new(boxX, topPos.Y + screenSize); b.BL.To = Vector2new(boxX + cornerLen, topPos.Y + screenSize)
                        b.BR.From = Vector2new(boxX + boxWidth, topPos.Y + screenSize); b.BR.To = Vector2new(boxX + boxWidth - cornerLen, topPos.Y + screenSize)
                        
                        b.L.From = Vector2new(boxX, topPos.Y); b.L.To = Vector2new(boxX, topPos.Y + cornerLen)
                        b.R.From = Vector2new(boxX + boxWidth, topPos.Y); b.R.To = Vector2new(boxX + boxWidth, topPos.Y + cornerLen)
                        b.T.From = Vector2new(boxX, topPos.Y + screenSize); b.T.To = Vector2new(boxX, topPos.Y + screenSize - cornerLen)
                        b.B.From = Vector2new(boxX + boxWidth, topPos.Y + screenSize); b.B.To = Vector2new(boxX + boxWidth, topPos.Y + screenSize - cornerLen)

                        for _, line in pairs(b) do 
                            line.Visible = true 
                            line.Color = visualColor
                            line.Transparency = 1
                        end

                        -- í—¤ë“œ ë— ê³„ì‚°
                        local distance = (camera.CFrame.Position - currentBestTarget.Position).Magnitude
                        TargetESP_HeadDot.Position = Vector2new(tPos.X, tPos.Y)
                        TargetESP_HeadDot.Radius = math.clamp((1 / distance) * 633, 1.2, 92)
                        TargetESP_HeadDot.Color = Color3.fromRGB(255, 255, 255) -- í—¤ë“œ ë—ì€ í°ìƒ‰ ê³ ì •
                        TargetESP_HeadDot.Visible = true
                    end
                end
            end
        end
    end)

    -- [í•µì‹¬ ì‹¤í–‰ ë¡œì§]
    if lockedTarget then
        local finalPos = lockedTarget.Position
        
        -- ì˜ˆì¸¡ ì‚¬ê²©
        if Toggles.PredictionEnabled.Value then
            local root = lockedTarget.Parent:FindFirstChild("HumanoidRootPart")
            if root then
                local distance = (camera.CFrame.Position - finalPos).Magnitude
                finalPos = finalPos + (root.Velocity * (distance / 500) * (Options.PredictionValue.Value * 0.2))
            end
        end

        -- ì¡°ì¤€ (Aimbot)
        if isAimKeyDown or isTriggerKeyDown then
            if Options.AimMethod.Value == "Camera" then
                local targetCF = CFnew(camera.CFrame.Position, finalPos)
                if Toggles.StrongLock.Value then camera.CFrame = targetCF
                else camera.CFrame = camera.CFrame:Lerp(targetCF, 1 / (Options.Smoothing.Value * 2.5)) end
            else
                local screenPos, onScreen = WorldToViewportPoint(camera, finalPos)
                if onScreen then
                    local deltaX = (screenPos.X - mouseLoc.X)
                    local deltaY = (screenPos.Y - mouseLoc.Y)
                    local smooth = Toggles.StrongLock.Value and 1 or (Options.Smoothing.Value * 1.5)
                    mousemoverel(deltaX / smooth, deltaY / smooth)
                end
            end
        end

        -- ì‚¬ê²© (TriggerBot) [ì˜¤ë¥˜ ìˆ˜ì •ë¨]
        if isTriggerKeyDown then
            -- [ì•ˆì „ì¥ì¹˜] íƒ€ê²Ÿì´ ì—†ìœ¼ë©´ ì¦‰ì‹œ ì‚¬ê²© ì¤‘ë‹¨ (ì˜¤ë¥˜ ë°©ì§€)
            if not lockedTarget then
                 if isCurrentlyFiring then mouse1release(); isCurrentlyFiring = false end
            else
                local canFire = true
                -- [ìˆ˜ì •] "360 check"ì™€ ì •í™•íˆ ë§¤ì¹­ (ê¸°ì¡´ "360"ìœ¼ë¡œ ë˜ì–´ìˆë˜ ë²„ê·¸ ìˆ˜ì •)
                if Options.TriggerType.Value == "FOV Check" then
                    local screenPos, onScreen = WorldToViewportPoint(camera, lockedTarget.Position)
                    if not onScreen or (Vector2new(screenPos.X, screenPos.Y) - mouseLoc).Magnitude > Options.FOVSize.Value then
                        canFire = false
                    end
                end

                if canFire and (tick() - lastFireTime >= Options.FireRate.Value) then
                    lastFireTime = tick()
                    mouse1release()
                    mouse1press()
                    isCurrentlyFiring = true
                elseif not canFire and isCurrentlyFiring then
                    mouse1release()
                    isCurrentlyFiring = false
                end
            end
        elseif isCurrentlyFiring then
            mouse1release()
            isCurrentlyFiring = false
        end
    else
        if isCurrentlyFiring then mouse1release(); isCurrentlyFiring = false end
    end
end)

Library:Notify("Lax Hub V1: Loaded successfully | GUI Toggle : Right Shift.")
