-- [[ 0. Xeno ìµœì í™” ë° ë¡œì»¬ ìºì‹± ê°•í™” ]]
local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local runService = game:GetService("RunService")
local userInput = game:GetService("UserInputService")
local camera = workspace.CurrentCamera

-- ë¹ˆë²ˆí•œ í˜¸ì¶œ í•¨ìˆ˜ ë¡œì»¬ ìºì‹± (CPU ë¶€í•˜ ê°ì†Œ)
local WorldToViewportPoint = camera.WorldToViewportPoint
local Vector2new = Vector2.new
local Vector3new = Vector3.new
local CFnew = CFrame.new
local mouse1press = mouse1press
local mouse1release = mouse1release
local mousemoverel = mousemoverel
local tick = tick

-- [[ ë£¨í”„ ì œì–´ ë³€ìˆ˜ ìµœìƒìœ„ ì„ ì–¸ ]]
local MainLoop = nil 
local SearchLoop = nil -- ìµœì í™”ë¥¼ ìœ„í•œ íƒìƒ‰ ì „ìš© ë£¨í”„ ì¶”ê°€

-- [[ 1. Xeno ì „ìš© Safe Drawing ì—”ì§„ ]]
local function CreateSafeDrawing(class, props)
    local obj = nil
    pcall(function() obj = Drawing.new(class) end)
    if not obj or type(obj) == "number" then
        return { Visible = false, Remove = function() end, Destroy = function() end }
    end
    for k, v in pairs(props) do pcall(function() obj[k] = v end) end
    return obj
end

local fovCircle = CreateSafeDrawing("Circle", {Thickness = 1, NumSides = 100, Radius = 150, Visible = false, Color = Color3.fromRGB(140, 0, 255)})
local targetLine = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false, Color = Color3.fromRGB(255, 0, 0)})

--------------------------------------------------
-- ğŸ¨ UI SYSTEM (ë¬´ê²°ì„± ë³´ì¡´)
--------------------------------------------------
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/Library.lua"))()

Library.BackgroundColor = Color3.fromRGB(10, 5, 20)
Library.MainColor       = Color3.fromRGB(25, 8, 45)
Library.AccentColor     = Color3.fromRGB(190, 40, 255)
Library.SelectedTabColor= Color3.fromRGB(150, 30, 220)
Library.OutlineColor    = Color3.fromRGB(60, 20, 100)

local Window = Library:CreateWindow({
    Title = "Lax Hub V1",
    Center = true,
    AutoShow = true,
    TabPadding = 8,
    MenuFadeTime = 0.2
})

local MainTab = Window:AddTab("Main")

-- [ğŸ¯ AIMBOT ì„¹ì…˜]
local AimBox = MainTab:AddLeftTabbox("Aimbot")
local AimTab = AimBox:AddTab("Aimbot") do
    AimTab:AddToggle("Enabled", { Text = "Aimbot ON / OFF", Default = false, Tooltip = "Toggle the main Aimbot system on or off." }):AddKeyPicker("AimKey", { Default = "T", SyncToggleState = true, Mode = "Toggle", Text = "Aimbot Key" })
    AimTab:AddDropdown("AimMethod", { Text = "Aimbot type", Default = "Camera", Values = { "Camera", "Mouse" }, Tooltip = "Choose between Camera manipulation or Mouse movement for aiming." })
    AimTab:AddToggle("TeamCheck", { Text = "Team Check", Default = true, Tooltip = "Prevents the script from targeting teammates." })
    AimTab:AddToggle("WallCheck", { Text = "Wall Check", Default = true, Tooltip = "Only targets enemies who are visible and not behind walls." })
    AimTab:AddToggle("FFCheck", { Text = "ForceField Check", Default = true, Tooltip = "Ignore players with active spawn protection (ForceField)." })
    AimTab:AddToggle("StrongLock", { Text = "Absolute Sticky Lock", Default = false, Tooltip = "Increases aim stickiness to prevent losing the target." })
    AimTab:AddSlider("Smoothing", { Text = "Aimbot Smoothness", Default = 2, Min = 1, Max = 10, Rounding = 1, Tooltip = "Controls how smoothly the aim follows the target. Higher = Smoother." })
    AimTab:AddSlider("AimMaxDistance", { Text = "Aimbot Scan Distance", Default = 1000, Min = 10, Max = 5000, Rounding = 0, Tooltip = "Maximum distance in studs to detect targets for Aimbot." })
    AimTab:AddToggle("ADSOnly", { Text = "Ads Check", Default = false, Tooltip = "Aimbot only activates while you are aiming down sights (Right Click)." })
    AimTab:AddToggle("PredictionEnabled", { Text = "Prediction (Lead Aim)", Default = false, Tooltip = "Calculates target movement to lead shots ahead of them." })
    AimTab:AddSlider("PredictionValue", { Text = "Prediction Intensity", Default = 5, Min = 1, Max = 10, Rounding = 1, Tooltip = "Adjust how far ahead the lead aim should predict." })
end

-- [ğŸ”« TRIGGERBOT ì„¹ì…˜]
local TriggerBox = MainTab:AddLeftTabbox("TriggerBot")
local TriggerTab = TriggerBox:AddTab("TriggerBot") do
    TriggerTab:AddToggle("GeneralTriggerBot", { Text = "TriggerBot ON / OFF", Default = false, Tooltip = "Automatically fires when an enemy is in range/FOV." }):AddKeyPicker("TriggerKey", { Default = "V", SyncToggleState = true, Mode = "Toggle", Text = "Trigger Key" })
    TriggerTab:AddDropdown("TriggerType", { Text = "Trigger Type", Default = "FOV Check", Values = { "360 check", "FOV Check" }, Tooltip = "360: Fires at anyone in world range. FOV Check: Only fires inside the circle." })
    TriggerTab:AddSlider("ScanRange360", { Text = "360 Scan Range", Default = 500, Min = 100, Max = 2000, Rounding = 0, Tooltip = "The maximum distance in studs for 360-degree detection." })
    TriggerTab:AddSlider("FireRate", { Text = "Fire Delay", Default = 0.05, Min = 0.01, Max = 2, Rounding = 2, Tooltip = "The delay between each shot fired by TriggerBot." })
end

-- [âš™ SETTINGS ì„¹ì…˜]
local SettingsBox = MainTab:AddRightTabbox("Settings")
local SettingsTab = SettingsBox:AddTab("Settings") do
    SettingsTab:AddToggle("ShowFOV", { Text = "Show FOV", Default = true, Tooltip = "Renders a visual circle representing your aim field-of-view." })
    SettingsTab:AddSlider("FOVSize", { Text = "FOV Size", Default = 150, Min = 10, Max = 800, Rounding = 0, Tooltip = "The radius of the Aimbot's activation area." })
    SettingsTab:AddToggle("ShowTracer", { Text = "Target Tracer ESP", Default = true, Tooltip = "Draws a line from your screen center to the current target." })
    SettingsTab:AddLabel("FOV Color"):AddColorPicker("FOVColor", { Default = Color3.fromRGB(140, 0, 255) })
    SettingsTab:AddLabel("Tracer Color"):AddColorPicker("TracerColor", { Default = Color3.fromRGB(255, 0, 0) })
    
    SettingsTab:AddButton("CRUSH GUI", function() 
        if MainLoop then MainLoop:Disconnect(); MainLoop = nil end 
        if SearchLoop then SearchLoop:Disconnect(); SearchLoop = nil end
        mouse1release()
        pcall(function() fovCircle:Remove() end)
        pcall(function() targetLine:Remove() end)
        Library:Unload() 
    end)
end

--------------------------------------------------
-- ğŸš€ CORE LOGIC (ìµœì í™” ì—”ì§„ ì ìš©)
--------------------------------------------------
local lastFireTime = 0
local lockedTarget = nil
local currentBestTarget = nil -- íƒìƒ‰ ë£¨í”„ì™€ ì‹¤í–‰ ë£¨í”„ ë¸Œë¦¿ì§€
local isCurrentlyFiring = false

-- ìµœì í™”ëœ ê°€ì‹œì„± ì²´í¬ (ë ˆì´ìºìŠ¤íŠ¸ íšŸìˆ˜ ìµœì†Œí™”)
local function isVisible(part, wallCheckEnabled)
    if not wallCheckEnabled then return true end
    local char = localPlayer.Character
    if not char then return false end
    
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {char, camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    local result = workspace:Raycast(camera.CFrame.Position, (part.Position - camera.CFrame.Position), params)
    return result == nil or result.Instance:IsDescendantOf(part.Parent)
end

-- [[ ìµœì í™” a: íƒ€ê²Ÿ íƒìƒ‰ ì „ìš© ë£¨í”„ (í•‘ ë° ë ‰ ë°©ì§€) ]]
SearchLoop = runService.Heartbeat:Connect(function()
    local isTriggerOn = Toggles.GeneralTriggerBot.Value
    local isAimOn = Toggles.Enabled.Value
    if not (isTriggerOn or isAimOn) then currentBestTarget = nil return end

    local myChar = localPlayer.Character
    local myHead = myChar and myChar:FindFirstChild("Head")
    if not myHead then currentBestTarget = nil return end

    local mouseLoc = userInput:GetMouseLocation()
    local tempBestTarget = nil
    local shortestDist = 9e9
    
    -- ì „ì—­ ì„¤ì • ìºì‹±
    local fovRadius = Options.FOVSize.Value
    local maxAimDist = Options.AimMaxDistance.Value
    local is360Mode = (isTriggerOn and Options.TriggerType.Value == "360")
    local scanRange360 = Options.ScanRange360.Value

    -- Sticky Lock ìš°ì„  ìˆœìœ„
    if Toggles.StrongLock.Value and lockedTarget then
        local lp = lockedTarget.Parent
        local lh = lp and lp:FindFirstChildOfClass("Humanoid")
        if lh and lh.Health > 0 then tempBestTarget = lockedTarget end
    end

    if not tempBestTarget then
        for _, player in ipairs(players:GetPlayers()) do
            if player == localPlayer then continue end
            if Toggles.TeamCheck.Value and player.Team == localPlayer.Team then continue end

            local char = player.Character
            local head = char and char:FindFirstChild("Head")
            local hum = char and char:FindFirstChildOfClass("Humanoid")

            if head and hum and hum.Health > 0 then
                if Toggles.FFCheck.Value and char:FindFirstChildOfClass("ForceField") then continue end

                local worldDist = (myHead.Position - head.Position).Magnitude
                
                -- ê°€ë²¼ìš´ ì¡°ê±´(ê±°ë¦¬/FOV)ì„ ë¨¼ì € ì²´í¬í•˜ì—¬ ë¬´ê±°ìš´ ë ˆì´ìºìŠ¤íŠ¸(í•‘ ìƒìŠ¹ ì›ì¸) íšŸìˆ˜ë¥¼ ì¤„ì„
                if is360Mode then
                    if worldDist <= scanRange360 and worldDist < shortestDist then
                        if isVisible(head, Toggles.WallCheck.Value) then
                            tempBestTarget = head; shortestDist = worldDist
                        end
                    end
                else
                    if worldDist <= maxAimDist then
                        local screenPos, onScreen = WorldToViewportPoint(camera, head.Position)
                        if onScreen then
                            local screenPos2D = Vector2new(screenPos.X, screenPos.Y)
                            local distFromMouse = (screenPos2D - mouseLoc).Magnitude
                            if distFromMouse <= fovRadius and distFromMouse < shortestDist then
                                if isVisible(head, Toggles.WallCheck.Value) then
                                    tempBestTarget = head; shortestDist = distFromMouse
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    currentBestTarget = tempBestTarget
end)

-- [[ ë©”ì¸ ì‹¤í–‰ ë£¨í”„ (RenderStepped: ì¡°ì¤€ ë°˜ì‘ì„± ìœ ì§€) ]]
MainLoop = runService.RenderStepped:Connect(function()
    local mouseLoc = userInput:GetMouseLocation()
    local isRightMouseDown = userInput:IsMouseButtonPressed(Enum.UserInputType.MouseButton2)
    local isTriggerKeyDown = Toggles.GeneralTriggerBot.Value
    local isAimKeyDown = Toggles.Enabled.Value and (not Toggles.ADSOnly.Value or isRightMouseDown)
    
    -- íƒ€ê²Ÿ ë™ê¸°í™”
    lockedTarget = (isAimKeyDown or isTriggerKeyDown) and currentBestTarget or nil

    -- [FOV ë Œë”ë§ ìµœì í™”]
    pcall(function()
        local is360Mode = (isTriggerKeyDown and Options.TriggerType.Value == "360")
        local shouldVisible = Toggles.ShowFOV.Value and not is360Mode
        fovCircle.Visible = shouldVisible
        if shouldVisible then
            fovCircle.Radius = Options.FOVSize.Value
            fovCircle.Position = mouseLoc
            fovCircle.Color = Options.FOVColor.Value
            fovCircle.Transparency = 1
        end
    end)

    -- [íƒ€ê²Ÿ íŠ¸ë ˆì´ì„œ ESP (ë¬´ê²°ì„± ë³´ì¡´)]
    pcall(function()
        if Toggles.ShowTracer.Value and currentBestTarget then
            local tPos, tOnScreen = WorldToViewportPoint(camera, currentBestTarget.Position)
            if tOnScreen then
                targetLine.Visible = true
                targetLine.From = Vector2new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
                targetLine.To = Vector2new(tPos.X, tPos.Y)
                targetLine.Color = Options.TracerColor.Value
            else targetLine.Visible = false end
        else targetLine.Visible = false end
    end)

    -- [í•µì‹¬ ì‹¤í–‰ ë¡œì§]
    if lockedTarget then
        local finalPos = lockedTarget.Position
        
        -- ì˜ˆì¸¡ ì‚¬ê²©
        if Toggles.PredictionEnabled.Value then
            local root = lockedTarget.Parent:FindFirstChild("HumanoidRootPart")
            if root then
                local distance = (camera.CFrame.Position - finalPos).Magnitude
                finalPos = finalPos + (root.Velocity * (distance / 500) * (Options.PredictionValue.Value * 0.2))
            end
        end

        -- ì¡°ì¤€ (Aimbot)
        if isAimKeyDown or isTriggerKeyDown then
            if Options.AimMethod.Value == "Camera" then
                local targetCF = CFnew(camera.CFrame.Position, finalPos)
                if Toggles.StrongLock.Value then camera.CFrame = targetCF
                else camera.CFrame = camera.CFrame:Lerp(targetCF, 1 / (Options.Smoothing.Value * 2.5)) end
            else
                local screenPos, onScreen = WorldToViewportPoint(camera, finalPos)
                if onScreen then
                    local deltaX = (screenPos.X - mouseLoc.X)
                    local deltaY = (screenPos.Y - mouseLoc.Y)
                    local smooth = Toggles.StrongLock.Value and 1 or (Options.Smoothing.Value * 1.5)
                    mousemoverel(deltaX / smooth, deltaY / smooth)
                end
            end
        end

        -- ì‚¬ê²© (TriggerBot)
        if isTriggerKeyDown then
            local canFire = true
            if Options.TriggerType.Value == "FOV Check" then
                local screenPos, onScreen = WorldToViewportPoint(camera, lockedTarget.Position)
                if not onScreen or (Vector2new(screenPos.X, screenPos.Y) - mouseLoc).Magnitude > Options.FOVSize.Value then
                    canFire = false
                end
            end

            if canFire and (tick() - lastFireTime >= Options.FireRate.Value) then
                lastFireTime = tick()
                mouse1release(); mouse1press()
                isCurrentlyFiring = true
            elseif not canFire and isCurrentlyFiring then
                mouse1release(); isCurrentlyFiring = false
            end
        elseif isCurrentlyFiring then
            mouse1release(); isCurrentlyFiring = false
        end
    else
        if isCurrentlyFiring then mouse1release(); isCurrentlyFiring = false end
    end
end)

Library:Notify("Lax Hub V1: Loaded successfully | GUI Toggle : Right Shift.")
