local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local tweenService = game:GetService("TweenService")
local runService = game:GetService("RunService")
local userInput = game:GetService("UserInputService")
local camera = workspace.CurrentCamera

-- [[ ì „ì—­ í•¨ìˆ˜ ë¡œì»¬ ìºì‹± ]]
local WorldToViewportPoint = camera.WorldToViewportPoint
local Vector2new = Vector2.new
local Vector3new = Vector3.new
local CFnew = CFrame.new
local tick = tick
local mouse1press = mouse1press
local mouse1release = mouse1release

-- [[ 1. ë¡œë”© í™”ë©´ GUI ìƒì„± ]]
local loadingGui = Instance.new("ScreenGui", localPlayer:WaitForChild("PlayerGui"))
loadingGui.DisplayOrder = 999 

local loadFrame = Instance.new("Frame", loadingGui)
loadFrame.Size = UDim2.new(0, 300, 0, 100); loadFrame.Position = UDim2.new(0.5, -150, 0.5, -50)
loadFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 18); Instance.new("UICorner", loadFrame)
local loadStroke = Instance.new("UIStroke", loadFrame); loadStroke.Color = Color3.fromRGB(140, 0, 255); loadStroke.Thickness = 2

local loadText = Instance.new("TextLabel", loadFrame)
loadText.Size = UDim2.new(1, 0, 0, 40); loadText.Position = UDim2.new(0, 0, 0.2, 0)
loadText.BackgroundTransparency = 1; loadText.Text = "Loading Lax Hub..."; loadText.TextColor3 = Color3.fromRGB(255, 255, 255)
loadText.Font = Enum.Font.GothamBold; loadText.TextSize = 18

local barBack = Instance.new("Frame", loadFrame); barBack.Size = UDim2.new(0.8, 0, 0, 6); barBack.Position = UDim2.new(0.1, 0, 0.7, 0); barBack.BackgroundColor3 = Color3.fromRGB(30, 30, 35); Instance.new("UICorner", barBack)
local barFill = Instance.new("Frame", barBack); barFill.Size = UDim2.new(0, 0, 1, 0); barFill.BackgroundColor3 = Color3.fromRGB(140, 0, 255); Instance.new("UICorner", barFill)

local tween = tweenService:Create(barFill, TweenInfo.new(3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 1, 0)})
tween:Play()

tween.Completed:Wait() 
task.wait(0.5)
loadingGui:Destroy()

-- [[ 2. ë¼ì´ë¸ŒëŸ¬ë¦¬ ë° ë“œë¡œìž‰ ê°ì²´ ì´ˆê¸°í™” ]]
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/Library.lua"))()

-- FOV ì›
local fovCircle = Drawing.new("Circle")
fovCircle.Thickness = 1; fovCircle.NumSides = 100; fovCircle.Radius = 150; fovCircle.Visible = false; fovCircle.Color = Color3.fromRGB(140, 0, 255)

-- íƒ€ê²Ÿ íŠ¸ë ˆì´ì„œ ESP (ì¶”ê°€ëœ ê¸°ëŠ¥)
local targetLine = Drawing.new("Line")
targetLine.Thickness = 1.5
targetLine.Transparency = 1
targetLine.Visible = false
targetLine.Color = Color3.fromRGB(255, 0, 0)

local lastFireTime = 0
local isDestroyed = false

local Window = Library:CreateWindow({
    Title = 'ðŸ’€ Lax Hub V1 ðŸ’€',
    Center = true,
    AutoShow = true, 
    TabPadding = 8,
    MenuFadeTime = 0.2
})

-- [[ 3. UI íƒ­ ë° ê¸°ëŠ¥ ]]
local MainTab = Window:AddTab("Main Features")
local SystemSection = MainTab:AddLeftTabbox("System Settings")
local Main = SystemSection:AddTab("Master") do
    Main:AddToggle("Enabled", { Text = "ì‹œìŠ¤í…œ ê°€ë™ ìƒíƒœ", Default = true }):AddKeyPicker("MasterKey", { Default = "T", SyncToggleState = true, Mode = "Toggle", Text = "Master Toggle" })
    Main:AddToggle("TeamCheck", { Text = "ì•„êµ° ë³´í˜¸ ëª¨ë“œ", Default = true })
    Main:AddToggle("FFCheck", { Text = "ë¬´ì  ìƒíƒœ ê°ì§€", Default = true })
    Main:AddToggle("WallCheck", { Text = "ë²½ íˆ¬ê³¼ ê²€ì‚¬", Default = true })
end

local AimSection = MainTab:AddLeftTabbox("Aim Assist")
local Aim = AimSection:AddTab("Aiming") do
    Aim:AddToggle("StrongLock", { Text = "ê°•ë ¥í•œ íƒ€ê²Ÿ ê³ ì •", Default = true })
    Aim:AddToggle("Is360Mode", { Text = "360ë„ ì „ë°©ìœ„ ì—”ì§„", Default = false })
    Aim:AddSlider("ScanRange360", { Text = "360ë„ ìŠ¤ìº” ë²”ìœ„", Default = 500, Min = 100, Max = 2000, Rounding = 0, Suffix = " studs" })
    Aim:AddToggle("ADSOnly", { Text = "ì •ë°€ ì¡°ì¤€ ì‹œ í™œì„±", Default = false })
    Aim:AddToggle("MouseAimEnabled", { Text = "ì—ìž„ë´‡(TYPE=MOUSE)", Default = false })
    
    -- [[ ì˜ˆì¸¡ ê¸°ëŠ¥ ì„¹ì…˜ ]]
    Aim:AddToggle("PredictionEnabled", { Text = "ì˜ˆì¸¡ ê¸°ëŠ¥", Default = false })
    Aim:AddSlider("PredictionValue", { Text = "ì˜ˆì¸¡ ê°•ë„(ê±°ë¦¬ ë³´ì •)", Default = 1.65, Min = 0.1, Max = 10, Rounding = 2, Suffix = "x" })
end

local FireSection = MainTab:AddRightTabbox("Combat Control")
local Fire = FireSection:AddTab("Firing") do
    Fire:AddToggle("AutoFire", { Text = "ìžë™ ê²©ë°œ ì‹œìŠ¤í…œ", Default = true })
    Fire:AddToggle("FOVPureFire", { Text = "FOV ê°ì‹œ ê²©ë°œ", Default = false })
    Fire:AddToggle("GeneralTriggerBot", { Text = "ì¼ë°˜ íŠ¸ë¦¬ê±° ë´‡", Default = false })
    Fire:AddSlider("FireRate", { Text = "ë°œì‚¬ ë”œë ˆì´", Default = 0.05, Min = 0.01, Max = 2, Rounding = 2, Suffix = "s" })
end

local VisualSection = MainTab:AddRightTabbox("Visuals")
local Visual = VisualSection:AddTab("Settings") do
    Visual:AddToggle("ShowFOV", { Text = "FOV ì› í‘œì‹œ", Default = true })
    Visual:AddToggle("ShowTracer", { Text = "íƒ€ê²Ÿ íŠ¸ë ˆì´ì„œ ESP", Default = true })
    Visual:AddSlider("FOVSize", { Text = "ì¡°ì¤€ ë²”ìœ„(FOV)", Default = 150, Min = 10, Max = 800, Rounding = 0 })
    Visual:AddLabel('Colors'):AddColorPicker('FOVColor', { Default = Color3.fromRGB(140, 0, 255) }):AddColorPicker('TracerColor', { Default = Color3.fromRGB(255, 0, 0) })
    Visual:AddButton("CRUSH GUI", function() isDestroyed = true; fovCircle:Remove(); targetLine:Remove(); Library:Unload() end)
end

-- [[ 4. í•µì‹¬ ë¡œì§ ì—”ì§„ ]]
local function isVisible(part, wallCheckEnabled)
    if not wallCheckEnabled then return true end
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {localPlayer.Character, camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    local result = workspace:Raycast(camera.CFrame.Position, part.Position - camera.CFrame.Position, params)
    return result == nil or result.Instance:IsDescendantOf(part.Parent)
end

runService.RenderStepped:Connect(function()
    if isDestroyed then return end
    
    local masterEnabled = Toggles.Enabled.Value
    if not masterEnabled then 
        fovCircle.Visible = false 
        targetLine.Visible = false
        return 
    end

    -- ë¡œì»¬ ìºì‹±
    local showFOV = Toggles.ShowFOV.Value
    local showTracer = Toggles.ShowTracer.Value
    local is360 = Toggles.Is360Mode.Value
    local fovSize = Options.FOVSize.Value
    local teamCheck = Toggles.TeamCheck.Value
    local ffCheck = Toggles.FFCheck.Value
    local wallCheck = Toggles.WallCheck.Value
    local adsOnly = Toggles.ADSOnly.Value
    local mouseAim = Toggles.MouseAimEnabled.Value
    local triggerBot = Toggles.GeneralTriggerBot.Value
    local fireRate = Options.FireRate.Value
    
    local predictOn = Toggles.PredictionEnabled.Value
    local predictVal = Options.PredictionValue.Value

    local mouseLoc = userInput:GetMouseLocation()
    fovCircle.Visible = showFOV and not is360
    fovCircle.Radius = fovSize
    fovCircle.Position = mouseLoc
    fovCircle.Color = Options.FOVColor.Value

    local target = nil
    local shortestDist = (is360 and Options.ScanRange360.Value or fovSize)
    local inFOV = false
    local isRightMouseDown = userInput:IsMouseButtonPressed(Enum.UserInputType.MouseButton2)
    local myChar = localPlayer.Character
    if not myChar then return end
    local myHead = myChar:FindFirstChild("Head")
    local myHRP = myChar:FindFirstChild("HumanoidRootPart")

    -- í”Œë ˆì´ì–´ íƒìƒ‰ ë£¨í”„
    for _, player in ipairs(players:GetPlayers()) do
        if player == localPlayer then continue end
        local char = player.Character
        if not (char and char:FindFirstChild("Head") and char:FindFirstChildOfClass("Humanoid") and char.Humanoid.Health > 0) then continue end
        if teamCheck and (player.Team == localPlayer.Team or player.TeamColor == localPlayer.TeamColor) then continue end
        if ffCheck and char:FindFirstChildOfClass("ForceField") then continue end
        
        local head = char.Head
        local screenPos, onScreen = WorldToViewportPoint(camera, head.Position)
        local screenPosV2 = Vector2new(screenPos.X, screenPos.Y)
        local distFromMouse = (screenPosV2 - mouseLoc).Magnitude

        if onScreen and distFromMouse <= fovSize then inFOV = true end
        
        if is360 then
            if myHead then
                local worldDist = (myHead.Position - head.Position).Magnitude
                if worldDist < shortestDist and isVisible(head, wallCheck) then
                    target = head; shortestDist = worldDist
                end
            end
        elseif onScreen and distFromMouse < shortestDist and isVisible(head, wallCheck) then
            target = head; shortestDist = distFromMouse
        end
    end

    -- ì¡°ì¤€ì  ê³„ì‚° (ì˜ˆì¸¡ í¬í•¨)
    local finalTargetPos = target and target.Position
    if target and predictOn then
        local root = target.Parent:FindFirstChild("HumanoidRootPart")
        if root then
            local velocity = root.Velocity
            local distance = (camera.CFrame.Position - target.Position).Magnitude
            finalTargetPos = target.Position + (velocity * (distance / 1000) * predictVal)
        end
    end

    -- íŠ¸ë ˆì´ì„œ ESP ì—…ë°ì´íŠ¸
    if target and showTracer then
        local tPos, tOnScreen = WorldToViewportPoint(camera, target.Position)
        if tOnScreen then
            targetLine.Visible = true
            targetLine.From = Vector2new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
            targetLine.To = Vector2new(tPos.X, tPos.Y)
            targetLine.Color = Options.TracerColor.Value
        else
            targetLine.Visible = false
        end
    else
        targetLine.Visible = false
    end

    -- ì¡°ì¤€ ë¡œì§ (ëª¸í†µ íšŒì „ ì •ë ¬ í¬í•¨)
    if target and finalTargetPos and myHRP then
        local humanoid = myChar:FindFirstChildOfClass("Humanoid")

        if triggerBot or (not adsOnly or isRightMouseDown) then
            -- ëª¸í†µì„ íƒ€ê²Ÿ ë°©í–¥ìœ¼ë¡œ ê°•ì œ íšŒì „ (ì˜ì‹¬ ë°©ì§€ ë° ë°œì‚¬ ê°ë„ í™•ë³´)
            if humanoid then humanoid.AutoRotate = false end
            
            -- HumanoidRootPartì˜ ë°©í–¥ì„ íƒ€ê²Ÿì˜ X, Z ì¢Œí‘œ(ìˆ˜í‰ ë°©í–¥)ë¡œ ë¶€ë“œëŸ½ê²Œ ê³ ì •
            local lookAtPos = Vector3new(finalTargetPos.X, myHRP.Position.Y, finalTargetPos.Z)
            myHRP.CFrame = myHRP.CFrame:Lerp(CFnew(myHRP.Position, lookAtPos), 0.2)
        end

        if triggerBot then
            camera.CFrame = CFnew(camera.CFrame.Position, finalTargetPos)
            if tick() - lastFireTime >= fireRate then
                lastFireTime = tick(); mouse1press(); task.delay(0.01, mouse1release)
            end
        else
            if mouseAim and isRightMouseDown and mousemoverel then
                local p = WorldToViewportPoint(camera, finalTargetPos)
                local center = Vector2new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
                mousemoverel((p.X - center.X) * 0.8, (p.Y - center.Y) * 0.8)
            elseif not mouseAim and (not adsOnly or isRightMouseDown) then
                local targetCF = CFnew(camera.CFrame.Position, finalTargetPos)
                camera.CFrame = Toggles.StrongLock.Value and targetCF or camera.CFrame:Lerp(targetCF, 0.2)
            end
        end
    elseif myChar:FindFirstChildOfClass("Humanoid") then
        myChar:FindFirstChildOfClass("Humanoid").AutoRotate = true
    end

    -- ìžë™ ì‚¬ê²©
    if not triggerBot and ((Toggles.AutoFire.Value and target) or (Toggles.FOVPureFire.Value and inFOV)) and (tick() - lastFireTime >= fireRate) then
        lastFireTime = tick(); mouse1press(); task.delay(0.01, mouse1release)
    end
end)
