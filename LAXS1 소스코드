-- [[ 0. Xeno ìµœì í™” ë° ë¡œì»¬ ìºì‹± ê°•í™” ]]
local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local runService = game:GetService("RunService")
local userInput = game:GetService("UserInputService")
local camera = workspace.CurrentCamera

-- ìì£¼ ì‚¬ìš©ë˜ëŠ” ë‚´ë¶€ í•¨ìˆ˜ ë¡œì»¬ ìºì‹± (ì†ë„ í–¥ìƒ)
local WorldToViewportPoint = camera.WorldToViewportPoint
local Vector2new = Vector2.new
local Vector3new = Vector3.new
local CFnew = CFrame.new
local mouse1press = mouse1press
local mouse1release = mouse1release
local mousemoverel = mousemoverel
local math_abs = math.abs
local tick = tick

-- [[ ë£¨í”„ ì œì–´ ë³€ìˆ˜ ìµœìƒìœ„ ì„ ì–¸ ]]
local MainLoop = nil 
local TargetLoop = nil

-- [[ 1. Xeno ì „ìš© Safe Drawing ì—”ì§„ ]]
local function CreateSafeDrawing(class, props)
    local obj = nil
    pcall(function() obj = Drawing.new(class) end)
    if not obj or type(obj) == "number" then
        return { Visible = false, Remove = function() end, Destroy = function() end }
    end
    for k, v in pairs(props) do pcall(function() obj[k] = v end) end
    return obj
end

local fovCircle = CreateSafeDrawing("Circle", {Thickness = 1, NumSides = 100, Radius = 150, Visible = false, Color = Color3.fromRGB(140, 0, 255)})
local targetLine = CreateSafeDrawing("Line", {Thickness = 1.5, Visible = false, Color = Color3.fromRGB(255, 0, 0)})

--------------------------------------------------
-- ğŸ¨ UI SYSTEM (ë¬´ê²°ì„± ìœ ì§€)
--------------------------------------------------
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/violin-suzutsuki/LinoriaLib/main/Library.lua"))()

Library.BackgroundColor = Color3.fromRGB(10, 5, 20)
Library.MainColor       = Color3.fromRGB(25, 8, 45)
Library.AccentColor     = Color3.fromRGB(190, 40, 255)
Library.SelectedTabColor= Color3.fromRGB(150, 30, 220)
Library.OutlineColor    = Color3.fromRGB(60, 20, 100)

local Window = Library:CreateWindow({
    Title = "Lax Hub S1",
    Center = true,
    AutoShow = true,
    TabPadding = 8,
    MenuFadeTime = 0.2
})

local MainTab = Window:AddTab("Main")

-- [ğŸ¯ AIMBOT ì„¹ì…˜]
local AimBox = MainTab:AddLeftTabbox("Aimbot")
local AimTab = AimBox:AddTab("Aimbot") do
    AimTab:AddToggle("Enabled", { Text = "Aimbot ON / OFF", Default = false, Tooltip = "Toggle the main Aimbot system on or off." }):AddKeyPicker("AimKey", { Default = "T", SyncToggleState = true, Mode = "Toggle", Text = "Aimbot Key" })
    AimTab:AddDropdown("AimMethod", { Text = "Aimbot type", Default = "Camera", Values = { "Camera", "Mouse" }, Tooltip = "Choose between Camera manipulation or Mouse movement for aiming." })
    AimTab:AddToggle("TeamCheck", { Text = "Team Check", Default = true, Tooltip = "Prevents the script from targeting teammates." })
    AimTab:AddToggle("WallCheck", { Text = "Wall Check", Default = true, Tooltip = "Only targets enemies who are visible and not behind walls." })
    AimTab:AddToggle("FFCheck", { Text = "ForceField Check", Default = true, Tooltip = "Ignore players with active spawn protection (ForceField)." })
    AimTab:AddToggle("StrongLock", { Text = "Sticky Lock", Default = false, Tooltip = "Increases aim stickiness to prevent losing the target." })
    AimTab:AddSlider("Smoothing", { Text = "Aimbot Smoothness", Default = 2, Min = 1, Max = 10, Rounding = 1, Tooltip = "Controls how smoothly the aim follows the target. Higher = Smoother." })
    AimTab:AddSlider("AimMaxDistance", { Text = "Aimbot Scan Distance", Default = 1000, Min = 10, Max = 5000, Rounding = 0, Tooltip = "Maximum distance in studs to detect targets for Aimbot." })
    AimTab:AddToggle("ADSOnly", { Text = "ADS Check", Default = false, Tooltip = "Aimbot only activates while you are aiming down sights (Right Click)." })
    AimTab:AddToggle("PredictionEnabled", { Text = "Prediction (lead aim)", Default = false, Tooltip = "Calculates target movement to lead shots ahead of them." })
    AimTab:AddSlider("PredictionValue", { Text = "Prediction Intensity", Default = 5, Min = 1, Max = 10, Rounding = 1, Tooltip = "Adjust how far ahead the lead aim should predict." })
end

-- [ğŸ”« TRIGGERBOT ì„¹ì…˜]
local TriggerBox = MainTab:AddLeftTabbox("TriggerBot")
local TriggerTab = TriggerBox:AddTab("TriggerBot") do
    TriggerTab:AddToggle("GeneralTriggerBot", { Text = "TriggerBot ON / OFF", Default = false, Tooltip = "Automatically fires when an enemy is in range/FOV." }):AddKeyPicker("TriggerKey", { Default = "V", SyncToggleState = true, Mode = "Toggle", Text = "Trigger Key" })
    TriggerTab:AddDropdown("TriggerType", { Text = "Trigger Type", Default = "FOV Check", Values = { "360 engine", "FOV Check" }, Tooltip = "360: Fires at anyone in world range. FOV Check: Only fires inside the circle." })
    TriggerTab:AddSlider("ScanRange360", { Text = "360 Scan Range", Default = 500, Min = 100, Max = 2000, Rounding = 0, Tooltip = "The maximum distance in studs for 360-degree detection." })
    TriggerTab:AddSlider("FireRate", { Text = "Fire Delay", Default = 0.05, Min = 0.01, Max = 2, Rounding = 2, Tooltip = "The delay between each shot fired by TriggerBot." })
end

-- [âš™ SETTINGS ì„¹ì…˜]
local SettingsBox = MainTab:AddRightTabbox("Settings")
local SettingsTab = SettingsBox:AddTab("Settings") do
    SettingsTab:AddToggle("ShowFOV", { Text = "Show FOV", Default = true, Tooltip = "Renders a visual circle representing your aim field-of-view." })
    SettingsTab:AddSlider("FOVSize", { Text = "FOV Size", Default = 150, Min = 10, Max = 800, Rounding = 0, Tooltip = "The radius of the Aimbot's activation area." })
    SettingsTab:AddToggle("ShowTracer", { Text = "Target Tracer ESP", Default = true, Tooltip = "Draws a line from your screen center to the current target." })
    SettingsTab:AddLabel("FOV Color"):AddColorPicker("FOVColor", { Default = Color3.fromRGB(140, 0, 255) })
    SettingsTab:AddLabel("Tracer Color"):AddColorPicker("TracerColor", { Default = Color3.fromRGB(255, 0, 0) })
    
    SettingsTab:AddButton("CRUSH GUI", function() 
        if MainLoop then MainLoop:Disconnect(); MainLoop = nil end 
        if TargetLoop then TargetLoop:Disconnect(); TargetLoop = nil end
        mouse1release()
        pcall(function() fovCircle:Remove() end)
        pcall(function() targetLine:Remove() end)
        Library:Unload() 
    end)
end

--------------------------------------------------
-- ğŸš€ OPTIMIZED CORE LOGIC
--------------------------------------------------
local lastFireTime = 0
local lockedTarget = nil
local bestTarget = nil
local isCurrentlyFiring = false

-- ë ˆì´ìºìŠ¤íŠ¸ ìµœì í™” (ê°€ì‹œì„± ì²´í¬)
local function isVisible(part, wallCheckEnabled)
    if not wallCheckEnabled then return true end
    local char = localPlayer.Character
    if not char then return false end
    
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {char, camera}
    params.FilterType = Enum.RaycastFilterType.Exclude
    local result = workspace:Raycast(camera.CFrame.Position, (part.Position - camera.CFrame.Position), params)
    return result == nil or result.Instance:IsDescendantOf(part.Parent)
end

-- [[ ìµœì í™” a: íƒ€ê²Ÿ íƒìƒ‰ ë£¨í”„ ë¶„ë¦¬ (Heartbeat í™œìš©ìœ¼ë¡œ FPS ë°©ì–´) ]]
TargetLoop = runService.Heartbeat:Connect(function()
    local myChar = localPlayer.Character
    if not myChar or not myChar:FindFirstChild("Head") then 
        bestTarget = nil
        return 
    end

    local isTriggerKeyDown = Toggles.GeneralTriggerBot.Value
    local isAimKeyDown = Toggles.Enabled.Value
    if not (isTriggerKeyDown or isAimKeyDown) then 
        bestTarget = nil 
        return 
    end

    local mouseLoc = userInput:GetMouseLocation()
    local tempBestTarget = nil
    local shortestDist = 9e9
    
    -- Sticky Lock ì²˜ë¦¬
    if Toggles.StrongLock.Value and lockedTarget then
        local char = lockedTarget.Parent
        local hum = char and char:FindFirstChildOfClass("Humanoid")
        if hum and hum.Health > 0 then
            tempBestTarget = lockedTarget
        end
    end

    if not tempBestTarget then
        local currentFovRadius = Options.FOVSize.Value
        local maxAimDist = Options.AimMaxDistance.Value
        local is360Mode = (isTriggerKeyDown and Options.TriggerType.Value == "360")
        local scanRange360 = Options.ScanRange360.Value

        for _, player in ipairs(players:GetPlayers()) do
            if player == localPlayer then continue end
            if Toggles.TeamCheck.Value and player.Team == localPlayer.Team then continue end

            local char = player.Character
            local head = char and char:FindFirstChild("Head")
            local hum = char and char:FindFirstChildOfClass("Humanoid")

            if head and hum and hum.Health > 0 then
                -- FFì²´í¬ë¥¼ ì›”ë“œ ê±°ë¦¬ ì²´í¬ë³´ë‹¤ ë¨¼ì € ìˆ˜í–‰í•˜ì—¬ ì—°ì‚° ì ˆì•½
                if Toggles.FFCheck.Value and char:FindFirstChildOfClass("ForceField") then continue end
                
                local worldDist = (myChar.Head.Position - head.Position).Magnitude
                
                if is360Mode then
                    if worldDist <= scanRange360 and worldDist < shortestDist then
                        if isVisible(head, Toggles.WallCheck.Value) then
                            tempBestTarget = head
                            shortestDist = worldDist
                        end
                    end
                else
                    if worldDist <= maxAimDist then
                        local screenPos, onScreen = WorldToViewportPoint(camera, head.Position)
                        if onScreen then
                            local distFromMouse = (Vector2new(screenPos.X, screenPos.Y) - mouseLoc).Magnitude
                            if distFromMouse <= currentFovRadius and distFromMouse < shortestDist then
                                if isVisible(head, Toggles.WallCheck.Value) then
                                    tempBestTarget = head
                                    shortestDist = distFromMouse
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    bestTarget = tempBestTarget
end)

-- [[ ë©”ì¸ ì‹¤í–‰ ë£¨í”„ (RenderStepped: ì¡°ì¤€ ë°˜ì‘ì„± ìœ ì§€) ]]
MainLoop = runService.RenderStepped:Connect(function()
    local mouseLoc = userInput:GetMouseLocation()
    local isRightMouseDown = userInput:IsMouseButtonPressed(Enum.UserInputType.MouseButton2)
    local isTriggerKeyDown = Toggles.GeneralTriggerBot.Value
    local isAimKeyDown = Toggles.Enabled.Value and (not Toggles.ADSOnly.Value or isRightMouseDown)
    
    -- FOV Circle ì—…ë°ì´íŠ¸ (ìµœì†Œ ì—°ì‚°)
    local is360Mode = (isTriggerKeyDown and Options.TriggerType.Value == "360")
    local shouldVisible = Toggles.ShowFOV.Value and not is360Mode
    fovCircle.Visible = shouldVisible
    if shouldVisible then
        fovCircle.Radius = Options.FOVSize.Value
        fovCircle.Position = mouseLoc
        fovCircle.Color = Options.FOVColor.Value
    end

    -- íƒ€ê²Ÿ ë½ ìƒíƒœ ê°±ì‹ 
    lockedTarget = (isAimKeyDown or isTriggerKeyDown) and bestTarget or nil

    -- íŠ¸ë ˆì´ì„œ & ì¡°ì¤€/ì‚¬ê²© ì‹¤í–‰
    if lockedTarget then
        local target = lockedTarget
        local finalPos = target.Position
        
        -- íŠ¸ë ˆì´ì„œ ì—…ë°ì´íŠ¸
        if Toggles.ShowTracer.Value then
            local tPos, tOnScreen = WorldToViewportPoint(camera, finalPos)
            if tOnScreen then
                targetLine.Visible = true
                targetLine.From = Vector2new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
                targetLine.To = Vector2new(tPos.X, tPos.Y)
                targetLine.Color = Options.TracerColor.Value
            else targetLine.Visible = false end
        else targetLine.Visible = false end

        -- ì˜ˆì¸¡ ì‚¬ê²©
        if Toggles.PredictionEnabled.Value then
            local root = target.Parent:FindFirstChild("HumanoidRootPart")
            if root then
                local distance = (camera.CFrame.Position - finalPos).Magnitude
                finalPos = finalPos + (root.Velocity * (distance / 500) * (Options.PredictionValue.Value * 0.2))
            end
        end

        -- ì¡°ì¤€(Aimbot)
        if isAimKeyDown or isTriggerKeyDown then
            if Options.AimMethod.Value == "Camera" then
                local targetCF = CFnew(camera.CFrame.Position, finalPos)
                if Toggles.StrongLock.Value then camera.CFrame = targetCF
                else camera.CFrame = camera.CFrame:Lerp(targetCF, 1 / (Options.Smoothing.Value * 2.5)) end
            else
                local screenPos, onScreen = WorldToViewportPoint(camera, finalPos)
                if onScreen then
                    local deltaX = (screenPos.X - mouseLoc.X)
                    local deltaY = (screenPos.Y - mouseLoc.Y)
                    local smooth = Toggles.StrongLock.Value and 1 or (Options.Smoothing.Value * 1.5)
                    mousemoverel(deltaX / smooth, deltaY / smooth)
                end
            end
        end

        -- ì‚¬ê²©(TriggerBot)
        if isTriggerKeyDown then
            local canFire = true
            if Options.TriggerType.Value == "FOV Check" then
                local screenPos, onScreen = WorldToViewportPoint(camera, target.Position)
                if not onScreen or (Vector2new(screenPos.X, screenPos.Y) - mouseLoc).Magnitude > Options.FOVSize.Value then
                    canFire = false
                end
            end

            if canFire then
                if tick() - lastFireTime >= Options.FireRate.Value then
                    lastFireTime = tick()
                    mouse1release(); mouse1press()
                    isCurrentlyFiring = true
                end
            elseif isCurrentlyFiring then mouse1release(); isCurrentlyFiring = false end
        elseif isCurrentlyFiring then mouse1release(); isCurrentlyFiring = false end
    else
        targetLine.Visible = false
        if isCurrentlyFiring then mouse1release(); isCurrentlyFiring = false end
    end
end)

Library:Notify("Lax Hub V1: Loaded successfully | GUI Toggle : Right Shift.")
